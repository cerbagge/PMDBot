# PMDBot 관리자 명령어 가이드라인

Planet Earth Minecraft 서버용 디스코드 봇의 관리자 명령어 사용 가이드입니다.

## ⓒ 2025. MF_MNT(cerbaggemoon@gmail.com)

---

## 목차
1. [권한 체계](#권한-체계)
2. [명령어 카테고리](#명령어-카테고리)
3. [시스템 관리 명령어](#시스템-관리-명령어)
4. [사용자 관리 명령어](#사용자-관리-명령어)
5. [대기열 관리 명령어](#대기열-관리-명령어)
6. [국가 및 동맹 관리 명령어](#국가-및-동맹-관리-명령어)
7. [마을 관리 명령어](#마을-관리-명령어)
8. [로그 및 리포트 명령어](#로그-및-리포트-명령어)
9. [모범 사례](#모범-사례)
10. [주의사항](#주의사항)
11. [문제 해결](#문제-해결)

---

## 권한 체계

PMDBot은 2단계 관리자 권한 체계를 사용합니다:

### 1. 전체 관리자 (Full Admin)
- **조건**: Discord 서버 관리자 권한 보유
- **권한**: 모든 관리자 명령어 사용 가능
- **확인 방법**: Discord 서버 설정에서 관리자 역할 확인

### 2. 콜사인 관리자 (Callsign Manager)
- **조건**: 특정 역할 보유 (역할 ID: `1448131353890783359`)
- **권한**: 콜사인 관련 명령어만 사용 가능
- **목적**: 콜사인 시스템 관리 권한 위임

### 권한 검증 방식
```
권한 체크 순서:
1. Discord 관리자 권한 확인 → 통과 시 모든 명령어 허용
2. 콜사인 관리자 역할 확인 → 통과 시 콜사인 명령어만 허용
3. 둘 다 없음 → 권한 거부
```

---

## 명령어 카테고리

총 **18개**의 관리자 명령어가 있으며, 기능별로 분류됩니다:

| 카테고리 | 명령어 수 | 설명 |
|---------|----------|------|
| 시스템 관리 | 3 | 봇 테스트, 스케줄러 확인, 수동 실행 |
| 사용자 관리 | 3 | 콜사인, 예외 설정, 데이터베이스 조회 |
| 대기열 관리 | 4 | 대기열 확인, 추가, 초기화, 자동 실행 설정 |
| 국가 및 동맹 | 3 | 국가 설정, 동맹 관리, 동맹 확인 |
| 마을 관리 | 2 | 마을 역할 연동, 마을 테스트 |
| 로그 및 리포트 | 2 | 로그 조회, 로그 관리 |

---

## 시스템 관리 명령어

### 1. `/테스트`

봇의 기본 기능을 테스트합니다.

**사용법:**
```
/테스트
```

**기능:**
- 봇 응답 확인
- 기본 연결 상태 확인
- 시스템 정상 작동 여부 검증

**예시:**
```
/테스트
→ "테스트 성공! 봇이 정상 작동 중입니다."
```

**사용 시나리오:**
- 봇 재시작 후 정상 작동 확인
- 명령어가 제대로 등록되었는지 확인
- 기본적인 문제 진단

---

### 2. `/스케줄확인`

자동 실행 스케줄러의 현재 설정 정보를 확인합니다.

**사용법:**
```
/스케줄확인
```

**확인 가능 정보:**
- 다음 자동 실행 예정 시간
- 스케줄러 활성화 상태
- 설정된 요일 및 시간
- 대상 역할 정보

**예시:**
```
/스케줄확인
→
자동 실행 스케줄:
- 다음 실행: 2025-01-20 09:00 (월요일)
- 실행 요일: 월요일
- 실행 시간: 09:00
- 대상 역할: @국민 역할
- 상태: 활성화됨
```

**사용 시나리오:**
- 자동 실행 시간 확인
- 스케줄러가 제대로 설정되었는지 검증
- 다음 실행 시간 예측

---

### 3. `/자동실행시작`

자동 역할 부여를 수동으로 즉시 실행합니다.

**사용법:**
```
/자동실행시작
```

**기능:**
- 스케줄과 무관하게 즉시 실행
- 설정된 역할을 가진 모든 사용자 처리
- 처리 결과 CSV 리포트 자동 생성

**실행 프로세스:**
1. 대상 역할을 가진 모든 사용자 수집
2. 각 사용자의 Discord-Minecraft 계정 연동 확인
3. 국가/마을 정보 조회
4. 적절한 역할 자동 부여
5. 결과를 성공/실패 채널에 전송
6. CSV 리포트 생성 및 업로드

**예시:**
```
/자동실행시작
→ "자동 실행을 시작합니다... (대상: 250명)"
→ (처리 중...)
→ "자동 실행 완료: 성공 230명, 실패 20명"
→ (CSV 파일 업로드)
```

**주의사항:**
- ⚠️ 많은 사용자를 한 번에 처리하므로 시간이 오래 걸릴 수 있음
- ⚠️ API 호출이 많아 서버 부하 가능성 있음
- ⚠️ 테스트 목적이 아니라면 자동 스케줄 사용 권장
- ⚠️ 실행 중 봇을 종료하지 마세요

**사용 시나리오:**
- 긴급하게 모든 사용자의 역할을 업데이트해야 할 때
- 새로운 역할 규칙 적용 후 즉시 반영
- 스케줄 실행 실패 시 수동 재실행

---

## 사용자 관리 명령어

### 4. `/콜사인관리`

사용자의 콜사인(별명)을 관리하는 종합 관리 명령어입니다.

**사용법:**
```
/콜사인관리 기능:[기능] [추가 파라미터...]
```

**기능 옵션:**

#### 4-1. `user-search` - 사용자 검색
특정 사용자의 콜사인 정보를 조회합니다.

```
/콜사인관리 기능:user-search 사용자:@사용자명
```

**조회 정보:**
- 현재 콜사인
- 마지막 변경 시간
- 쿨다운 남은 시간
- 금지 여부

**예시:**
```
/콜사인관리 기능:user-search 사용자:@홍길동
→
사용자: 홍길동 (ID: 123456789)
현재 콜사인: [전설] 용사
마지막 변경: 2025-01-15 14:30
쿨다운 남은 시간: 10일
금지 상태: 없음
```

#### 4-2. `change` - 콜사인 강제 변경
관리자가 사용자의 콜사인을 강제로 변경합니다 (쿨타임 무시).

```
/콜사인관리 기능:change 사용자:@사용자명 새콜사인:[새 콜사인]
```

**주의사항:**
- 쿨타임이 무시되므로 신중하게 사용
- 부적절한 콜사인 즉시 수정 시 사용
- 변경 내역이 로그에 기록됨

**예시:**
```
/콜사인관리 기능:change 사용자:@홍길동 새콜사인:[초보] 홍길동
→ "홍길동의 콜사인을 '[초보] 홍길동'으로 변경했습니다."
```

#### 4-3. `list` - 전체 콜사인 목록
모든 사용자의 콜사인 목록을 출력합니다.

```
/콜사인관리 기능:list
```

**출력 형식:**
- 사용자명 → 콜사인
- 마지막 변경 시간
- 총 콜사인 개수

**예시:**
```
/콜사인관리 기능:list
→
전체 콜사인 목록 (총 125개)
1. 홍길동 → [전설] 용사 (2025-01-15)
2. 김철수 → [초보] 모험가 (2025-01-10)
...
```

#### 4-4. `ban` - 콜사인 금지
특정 콜사인을 금지 목록에 추가합니다.

```
/콜사인관리 기능:ban 콜사인:[금지할 콜사인] 사유:[사유]
```

**기능:**
- 해당 콜사인 사용 불가
- 부분 일치 검사 (예: "바보" 금지 시 "멍청한바보"도 차단)
- 금지 사유 기록

**예시:**
```
/콜사인관리 기능:ban 콜사인:욕설 사유:부적절한 표현
→ "'욕설'을 콜사인 금지 목록에 추가했습니다."
```

#### 4-5. `unban` - 콜사인 금지 해제
금지된 콜사인을 허용 목록으로 복구합니다.

```
/콜사인관리 기능:unban 콜사인:[해제할 콜사인]
```

**예시:**
```
/콜사인관리 기능:unban 콜사인:욕설
→ "'욕설'을 금지 목록에서 제거했습니다."
```

#### 4-6. `ban-list` - 금지 목록 조회
현재 금지된 모든 콜사인 목록을 확인합니다.

```
/콜사인관리 기능:ban-list
```

**예시:**
```
/콜사인관리 기능:ban-list
→
금지된 콜사인 목록 (총 5개)
1. 욕설 - 사유: 부적절한 표현
2. 광고 - 사유: 홍보성 콘텐츠
...
```

#### 4-7. `cooldown-reset` - 쿨타임 초기화
특정 사용자의 콜사인 쿨다운을 초기화합니다.

```
/콜사인관리 기능:cooldown-reset 사용자:@사용자명
```

**주의사항:**
- 쿨타임이 완전히 제거됨
- 사용자가 즉시 콜사인 변경 가능
- 특별한 사유가 있을 때만 사용

**예시:**
```
/콜사인관리 기능:cooldown-reset 사용자:@홍길동
→ "홍길동의 콜사인 쿨다운을 초기화했습니다."
```

#### 4-8. `backup` - 콜사인 백업
현재 콜사인 데이터를 백업합니다.

```
/콜사인관리 기능:backup
```

**기능:**
- JSON 형식으로 백업 파일 생성
- Discord 채널에 파일 업로드
- `data/callsign_backups/` 폴더에 저장

**백업 파일명 형식:**
```
callsign_backup_manual_20250116_143022.json
```

**예시:**
```
/콜사인관리 기능:backup
→ "백업 생성 중..."
→ (파일 업로드)
→ "콜사인 백업 완료: callsign_backup_manual_20250116_143022.json"
```

#### 4-9. `restore` - 콜사인 복구
백업 파일에서 콜사인 데이터를 복구합니다.

```
/콜사인관리 기능:restore 백업파일:[파일명]
```

**주의사항:**
- ⚠️ 현재 콜사인 데이터가 모두 덮어씌워짐
- ⚠️ 복구 전 반드시 현재 데이터 백업 권장
- ⚠️ 되돌릴 수 없으므로 신중하게 사용

**예시:**
```
/콜사인관리 기능:restore 백업파일:callsign_backup_manual_20250116_143022.json
→ "콜사인 데이터를 복구하시겠습니까? (현재 데이터가 덮어씌워집니다)"
→ (확인 후)
→ "복구 완료: 125개 콜사인이 복구되었습니다."
```

#### 4-10. `upload` - 백업 파일 업로드
외부 백업 파일을 봇에 업로드하여 사용합니다.

```
/콜사인관리 기능:upload 파일:[첨부 파일]
```

**사용 시나리오:**
- 다른 서버의 콜사인 데이터 이전
- 수동으로 편집한 백업 파일 적용

---

### 5. `/예외설정`

자동 실행 시 처리하지 않을 예외 사용자를 관리합니다.

**사용법:**
```
/예외설정 기능:[기능] 대상:[@사용자 또는 ID]
```

**기능 옵션:**

#### 5-1. `add` - 예외 추가
```
/예외설정 기능:add 대상:@홍길동
```

**예시:**
```
/예외설정 기능:add 대상:@홍길동
→ "홍길동을 예외 목록에 추가했습니다."
```

#### 5-2. `remove` - 예외 제거
```
/예외설정 기능:remove 대상:@홍길동
```

#### 5-3. `list` - 예외 목록 조회
```
/예외설정 기능:list
→
예외 사용자 목록 (총 3명)
1. 홍길동 (ID: 123456789)
2. 김철수 (ID: 987654321)
...
```

**사용 시나리오:**
- 봇 역할을 받지 않길 원하는 사용자
- 테스트 계정
- 특별 관리 필요 계정

---

### 6. `/데이터베이스`

사용자 데이터베이스를 조회하고 관리합니다.

**사용법:**
```
/데이터베이스 기능:[기능] [추가 파라미터...]
```

**기능 옵션:**

#### 6-1. `user-search` - 사용자 검색
Discord ID로 사용자 정보를 조회합니다.

```
/데이터베이스 기능:user-search 사용자:@사용자명
```

**조회 정보:**
- Minecraft UUID
- 현재 국가
- 현재 마을
- 닉네임 변경 이력
- 마지막 업데이트 시간

**예시:**
```
/데이터베이스 기능:user-search 사용자:@홍길동
→
사용자 정보:
Discord: 홍길동 (ID: 123456789)
Minecraft UUID: 550e8400-e29b-41d4-a716-446655440000
현재 국가: Seoul
현재 마을: Gangnam
닉네임 이력: Steve → HongGilDong
마지막 업데이트: 2025-01-15 14:30
```

#### 6-2. `nickname-search` - 닉네임 검색
Minecraft 닉네임으로 사용자를 검색합니다.

```
/데이터베이스 기능:nickname-search 닉네임:[Minecraft 닉네임]
```

**예시:**
```
/데이터베이스 기능:nickname-search 닉네임:HongGilDong
→
검색 결과:
Discord: 홍길동 (ID: 123456789)
현재 닉네임: HongGilDong
이전 닉네임: Steve
...
```

#### 6-3. `stats` - 통계 조회
데이터베이스 전체 통계를 확인합니다.

```
/데이터베이스 기능:stats
```

**통계 정보:**
- 총 사용자 수
- 국가별 사용자 분포
- 마을별 사용자 분포
- 최근 활동 사용자 수

**예시:**
```
/데이터베이스 기능:stats
→
데이터베이스 통계:
총 사용자: 250명
국가별 분포:
  - Seoul: 120명
  - Busan: 80명
  - Others: 50명
마을별 분포:
  - Gangnam: 45명
  - Haeundae: 30명
  ...
최근 7일 활동: 180명
```

#### 6-4. `all-users` - 전체 사용자 목록
모든 사용자 정보를 출력합니다 (대용량 출력 주의).

```
/데이터베이스 기능:all-users
```

**주의사항:**
- ⚠️ 많은 사용자가 있을 경우 응답이 매우 길어질 수 있음
- ⚠️ 파일로 내보내기 권장

---

## 대기열 관리 명령어

### 7. `/대기열상태`

현재 대기열의 상태를 확인합니다.

**사용법:**
```
/대기열상태
```

**확인 정보:**
- 대기열 크기 (대기 중인 사용자 수)
- 처리 중 여부
- 예상 처리 시간

**예시:**
```
/대기열상태
→
대기열 현황:
대기 중: 25명
처리 중: 5명
완료: 120명
예상 완료 시간: 약 3분
```

**사용 시나리오:**
- 대량 처리 진행 상황 확인
- 시스템 부하 모니터링
- 처리 완료 예측

---

### 8. `/대기열추가`

사용자 또는 역할의 모든 멤버를 대기열에 추가합니다.

**사용법:**
```
/대기열추가 대상:[@사용자 또는 @역할]
```

**기능:**
- 단일 사용자 추가
- 역할의 모든 멤버 일괄 추가
- 중복 추가 방지

**예시 1: 사용자 추가**
```
/대기열추가 대상:@홍길동
→ "홍길동을 대기열에 추가했습니다."
```

**예시 2: 역할 추가**
```
/대기열추가 대상:@국민
→ "국민 역할의 250명을 대기열에 추가했습니다."
```

**사용 시나리오:**
- 특정 사용자만 즉시 처리하고 싶을 때
- 특정 역할 그룹만 업데이트
- 자동 실행과 별개로 추가 처리

---

### 9. `/대기열초기화`

대기열의 모든 항목을 제거합니다.

**사용법:**
```
/대기열초기화
```

**주의사항:**
- ⚠️ 대기 중인 모든 사용자가 제거됨
- ⚠️ 되돌릴 수 없음
- ⚠️ 처리 중인 작업은 즉시 중단되지 않을 수 있음

**예시:**
```
/대기열초기화
→ "대기열을 초기화하시겠습니까? (25명의 대기 항목이 삭제됩니다)"
→ (확인 후)
→ "대기열이 초기화되었습니다."
```

**사용 시나리오:**
- 잘못된 대량 추가 시 취소
- 시스템 부하가 너무 클 때 긴급 중단
- 대기열 오류 발생 시 리셋

---

### 10. `/자동실행`

자동 실행 시 처리할 역할 ID를 설정합니다.

**사용법:**
```
/자동실행 역할id:[역할 ID]
```

**역할 ID 확인 방법:**
1. Discord 개발자 모드 활성화
2. 역할 우클릭 → "ID 복사"

**예시:**
```
/자동실행 역할id:1234567890123456789
→ "자동 실행 역할이 설정되었습니다."
→ "역할 ID: 1234567890123456789"
→ "다음 자동 실행 시 이 역할을 가진 사용자가 처리됩니다."
```

**주의사항:**
- 역할 ID는 숫자로만 구성
- 잘못된 ID 입력 시 자동 실행 실패 가능
- 설정 후 `/스케줄확인`으로 검증 권장

---

## 국가 및 동맹 관리 명령어

### 11. `/국가설정`

봇의 기본 국가(BASE_NATION)를 설정합니다.

**사용법:**
```
/국가설정 국가:[국가명]
```

**기능:**
- 봇이 기준으로 삼는 국가 설정
- 국적 확인 시 기본 국가와 비교
- 동맹 관계 판단 기준

**예시:**
```
/국가설정 국가:Seoul
→ "기본 국가를 'Seoul'로 설정했습니다."
```

**주의사항:**
- Planet Earth 서버에 실제로 존재하는 국가명 입력
- 대소문자 정확히 입력
- 설정 후 기존 사용자 역할은 자동 업데이트되지 않음 (자동 실행 필요)

---

### 12. `/동맹설정`

동맹 국가 및 마을을 관리합니다.

**사용법:**
```
/동맹설정 기능:[기능] [추가 파라미터...]
```

**기능 옵션:**

#### 12-1. `add` - 동맹 추가
국가 또는 마을을 동맹으로 추가합니다.

```
/동맹설정 기능:add 이름:[국가/마을명] 역할:[@역할]
```

**예시 1: 국가 동맹 추가**
```
/동맹설정 기능:add 이름:Busan 역할:@부산동맹
→ "Busan을 동맹 국가로 추가했습니다."
→ "역할: @부산동맹"
```

**예시 2: 마을 동맹 추가**
```
/동맹설정 기능:add 이름:Gangnam 역할:@강남마을
→ "Gangnam을 동맹 마을로 추가했습니다."
→ "역할: @강남마을"
```

#### 12-2. `remove` - 동맹 제거
동맹 목록에서 국가/마을을 제거합니다.

```
/동맹설정 기능:remove 이름:[국가/마을명]
```

**예시:**
```
/동맹설정 기능:remove 이름:Busan
→ "Busan을 동맹 목록에서 제거했습니다."
```

#### 12-3. `list` - 동맹 목록 조회
모든 동맹 국가 및 마을 목록을 확인합니다.

```
/동맹설정 기능:list
```

**예시:**
```
/동맹설정 기능:list
→
동맹 국가 및 마을 목록:

[국가] Busan
  - 역할: @부산동맹
  - UUID: 550e8400-e29b-41d4-a716-446655440001

[마을] Gangnam
  - 역할: @강남마을
  - UUID: 550e8400-e29b-41d4-a716-446655440002
  - 소속 국가: Seoul

총 2개 동맹
```

#### 12-4. `role-set` - 동맹 역할 변경
기존 동맹의 역할을 변경합니다.

```
/동맹설정 기능:role-set 이름:[국가/마을명] 역할:[@새 역할]
```

**예시:**
```
/동맹설정 기능:role-set 이름:Busan 역할:@부산신동맹
→ "Busan의 역할을 @부산신동맹으로 변경했습니다."
```

**주의사항:**
- 동맹은 UUID 기반으로 저장됨 (이름 변경에도 안정적)
- 역할 변경 후 `/동맹확인` 명령어로 기존 멤버 역할 업데이트 권장
- 동맹 추가 시 해당 국가/마을이 실제로 존재해야 함

---

### 13. `/동맹확인`

모든 Discord 멤버의 동맹 역할을 재확인하고 갱신합니다.

**사용법:**
```
/동맹확인
```

**기능:**
- 모든 서버 멤버의 국가/마을 확인
- 동맹 조건 충족 시 역할 자동 부여
- 동맹 조건 미충족 시 역할 제거
- UUID 기반 정확한 판별

**실행 프로세스:**
1. Discord 서버의 모든 멤버 조회
2. 각 멤버의 Minecraft 계정 연동 확인
3. 현재 국가/마을 정보 조회
4. 동맹 국가/마을 여부 판단
5. 역할 부여 또는 제거

**예시:**
```
/동맹확인
→ "동맹 역할을 확인하고 있습니다... (총 250명)"
→ (처리 중...)
→ "동맹 역할 확인 완료:"
→ "- 역할 부여: 45명"
→ "- 역할 제거: 12명"
→ "- 변경 없음: 193명"
```

**사용 시나리오:**
- 새로운 동맹 추가 후
- 동맹 역할 변경 후
- 동맹 시스템 오류 발생 시
- 정기적인 역할 동기화

**주의사항:**
- ⚠️ 많은 사용자가 있을 경우 시간이 오래 걸림
- ⚠️ API 호출이 많아 서버 부하 가능성 있음
- ⚠️ 실행 중 봇을 종료하지 마세요

---

## 마을 관리 명령어

### 14. `/마을역할`

특정 마을과 Discord 역할을 연동합니다.

**사용법:**
```
/마을역할 기능:[기능] [추가 파라미터...]
```

**기능 옵션:**

#### 14-1. `add` - 마을 역할 추가
마을과 역할을 연결합니다.

```
/마을역할 기능:add 역할:[@역할] 마을:[마을명]
```

**예시:**
```
/마을역할 기능:add 역할:@강남구민 마을:Gangnam
→ "Gangnam 마을에 @강남구민 역할을 연동했습니다."
```

#### 14-2. `remove` - 마을 역할 제거
마을-역할 연동을 해제합니다.

```
/마을역할 기능:remove 역할:[@역할] 마을:[마을명]
```

#### 14-3. `list` - 마을 역할 목록
모든 마을-역할 매핑을 조회합니다.

```
/마을역할 기능:list
```

**예시:**
```
/마을역할 기능:list
→
마을 역할 매핑 목록:

[마을] Gangnam (Seoul)
  - 역할: @강남구민
  - UUID: 550e8400-e29b-41d4-a716-446655440003

[마을] Haeundae (Busan)
  - 역할: @해운대구민
  - UUID: 550e8400-e29b-41d4-a716-446655440004

총 2개 매핑
```

#### 14-4. `town-list` - 마을 목록 조회
Planet Earth API에서 실제 존재하는 마을 목록을 조회합니다.

```
/마을역할 기능:town-list
```

**예시:**
```
/마을역할 기능:town-list
→
Planet Earth 마을 목록:
1. Gangnam (Seoul) - 시장: HongGilDong
2. Haeundae (Busan) - 시장: KimCheolSu
...
총 45개 마을
```

**주의사항:**
- 마을은 UUID 기반으로 저장됨
- 마을 이름이 변경되어도 연동 유지
- 자동 실행 시 마을 역할이 자동 부여됨

---

### 15. `/마을테스트`

마을 검증 기능을 테스트합니다 (디버깅용).

**사용법:**
```
/마을테스트 [마을:마을명]
```

**기능:**
- 마을이 Planet Earth에 실제로 존재하는지 확인
- 마을의 UUID 조회
- 마을 정보 (시장, 소속 국가, 주민 수 등)
- API 응답 시간 측정

**예시 1: 특정 마을 테스트**
```
/마을테스트 마을:Gangnam
→
마을 테스트 결과: Gangnam
- 존재 여부: 존재함
- UUID: 550e8400-e29b-41d4-a716-446655440003
- 소속 국가: Seoul
- 시장: HongGilDong
- 주민 수: 25명
- API 응답 시간: 234ms
```

**예시 2: 전체 시스템 테스트**
```
/마을테스트
→
마을 시스템 테스트:
- API 연결: 정상
- 등록된 마을 역할 매핑: 2개
- 테스트 통과: 2/2
- 평균 응답 시간: 198ms
```

**사용 시나리오:**
- 마을 역할 설정 전 마을 존재 확인
- API 연동 문제 진단
- 마을 정보 빠른 조회

---

## 로그 및 리포트 명령어

### 16. `/로그조회`

시스템 로그를 검색하고 조회합니다.

**사용법:**
```
/로그조회 [범위:날짜 범위] [카테고리:카테고리] [사용자:@사용자] [날짜:YYYY-MM-DD]
```

**파라미터 (모두 선택사항):**
- `범위`: `today`, `week`, `month`, `all` (기본값: `today`)
- `카테고리`: 로그 카테고리 (아래 참조)
- `사용자`: 특정 사용자의 로그만 조회
- `날짜`: 특정 날짜의 로그 조회 (YYYY-MM-DD 형식)

**로그 카테고리:**
- `콜사인` - 콜사인 변경, 관리
- `대기열` - 대기열 추가, 처리
- `동맹` - 동맹 추가, 제거, 확인
- `역할` - 역할 부여, 제거
- `예외처리` - 예외 사용자 관리
- `스케줄러` - 자동 실행 로그
- `시스템` - 시스템 오류, 경고
- `관리자` - 관리자 명령어 실행

**예시 1: 오늘의 모든 로그**
```
/로그조회
→
2025-01-16 로그 (총 45건)

[14:30:22] [콜사인] 홍길동: 콜사인 변경 "[전설] 용사"
[14:31:15] [역할] 김철수: 역할 부여 "@국민"
[14:32:08] [동맹] 관리자: Busan 동맹 추가
...
```

**예시 2: 특정 카테고리 로그**
```
/로그조회 범위:week 카테고리:콜사인
→
최근 7일 콜사인 로그 (총 23건)

[2025-01-16 14:30] 홍길동: "[전설] 용사"
[2025-01-15 18:45] 김철수: "[초보] 모험가"
...
```

**예시 3: 특정 사용자 로그**
```
/로그조회 범위:month 사용자:@홍길동
→
홍길동의 최근 한 달 로그 (총 8건)

[2025-01-16] 콜사인 변경
[2025-01-15] 역할 부여
[2025-01-10] 국적 확인
...
```

**예시 4: 특정 날짜 로그**
```
/로그조회 날짜:2025-01-15
→
2025-01-15 로그 (총 67건)
...
```

**사용 시나리오:**
- 사용자 활동 이력 확인
- 시스템 오류 추적
- 관리자 액션 감사
- 통계 데이터 수집

---

### 17. `/로그관리`

로그 시스템을 관리합니다.

**사용법:**
```
/로그관리 기능:[기능]
```

**기능 옵션:**

#### 17-1. `statistics` - 로그 통계
로그 데이터베이스의 통계를 확인합니다.

```
/로그관리 기능:statistics
```

**통계 정보:**
- 총 로그 수
- 카테고리별 로그 분포
- 로그 레벨별 분포
- 최근 활동 통계
- 데이터베이스 크기

**예시:**
```
/로그관리 기능:statistics
→
로그 통계:
총 로그 수: 12,345건
데이터베이스 크기: 5.2 MB

카테고리별 분포:
  - 콜사인: 3,456건 (28%)
  - 역할: 4,567건 (37%)
  - 동맹: 1,234건 (10%)
  - 시스템: 2,088건 (17%)
  - 기타: 1,000건 (8%)

로그 레벨별 분포:
  - INFO: 10,234건 (83%)
  - WARNING: 1,567건 (13%)
  - ERROR: 544건 (4%)

최근 활동:
  - 오늘: 234건
  - 이번 주: 1,678건
  - 이번 달: 5,432건
```

#### 17-2. `cleanup` - 로그 정리
오래된 로그를 자동으로 삭제합니다.

```
/로그관리 기능:cleanup 기간:[일수]
```

**예시:**
```
/로그관리 기능:cleanup 기간:30
→ "30일 이상 오래된 로그를 삭제하시겠습니까?"
→ (확인 후)
→ "1,234건의 로그가 삭제되었습니다."
→ "데이터베이스 크기: 5.2 MB → 3.1 MB"
```

**주의사항:**
- ⚠️ 삭제된 로그는 복구할 수 없음
- ⚠️ 삭제 전 백업 권장
- 기본적으로 30일 이상 오래된 로그 자동 정리됨

#### 17-3. `export` - 로그 내보내기
로그를 JSON 또는 CSV 파일로 내보냅니다.

```
/로그관리 기능:export 형식:[json/csv] 범위:[날짜 범위]
```

**예시:**
```
/로그관리 기능:export 형식:csv 범위:month
→ "로그를 내보내는 중..."
→ (파일 업로드)
→ "로그 내보내기 완료: logs_export_202501.csv (1,234건)"
```

**사용 시나리오:**
- 외부 분석 도구로 로그 분석
- Excel로 통계 작성
- 장기 아카이브

#### 17-4. `backup` - 로그 백업
로그 데이터베이스를 백업합니다.

```
/로그관리 기능:backup
```

**예시:**
```
/로그관리 기능:backup
→ "로그 데이터베이스를 백업하는 중..."
→ (파일 업로드)
→ "백업 완료: bot_logs_backup_20250116.db (5.2 MB)"
```

**사용 시나리오:**
- 로그 정리 전 백업
- 정기적인 데이터 백업
- 시스템 이전 전 데이터 보존

---

## 추가 명령어

### 18. `/서버대기열`

Planet Earth 서버 접속 대기열을 확인합니다 (사용자도 사용 가능).

**사용법:**
```
/서버대기열
```

**기능:**
- 현재 서버 대기열 상태 확인
- 대기 인원 수
- 예상 대기 시간
- 서버 온라인 여부

**예시:**
```
/서버대기열
→
Planet Earth 서버 상태:
- 서버 상태: 온라인
- 현재 플레이어: 85/100
- 대기열: 15명
- 예상 대기 시간: 약 5분
```

**사용 시나리오:**
- 서버 접속 전 대기열 확인
- 서버 과부하 모니터링
- 플레이어에게 정보 제공

---

## 모범 사례

### 1. 정기적인 백업
- 콜사인 데이터를 주 1회 이상 백업
- 데이터베이스를 월 1회 백업
- 로그를 분기별로 내보내기 및 아카이브

### 2. 로그 관리
- 로그를 정기적으로 조회하여 이상 징후 확인
- 30일마다 오래된 로그 정리
- 중요한 로그는 CSV로 내보내서 보관

### 3. 역할 동기화
- 동맹 변경 시 `/동맹확인` 명령어 실행
- 주 1회 자동 실행으로 역할 동기화
- 역할 변경 후 사용자 피드백 확인

### 4. 대기열 관리
- 대량 작업 전 `/대기열상태`로 현재 부하 확인
- 처리 중 오류 발생 시 `/대기열초기화`로 리셋
- 특정 역할만 처리할 때 `/대기열추가` 활용

### 5. 콜사인 관리
- 금지 목록을 정기적으로 업데이트
- 부적절한 콜사인 발견 시 즉시 `/콜사인관리 change`로 수정
- 쿨타임 초기화는 특별한 사유가 있을 때만 사용

### 6. 데이터 검증
- 새로운 동맹/마을 추가 전 `/마을테스트`로 확인
- 데이터베이스 통계를 정기적으로 확인
- API 연동 문제 발생 시 `/테스트`로 진단

---

## 주의사항

### ⚠️ 중요한 경고

1. **복구 불가능한 명령어**
   - `/대기열초기화` - 대기열 모두 삭제
   - `/콜사인관리 restore` - 현재 콜사인 데이터 덮어쓰기
   - `/로그관리 cleanup` - 오래된 로그 삭제
   - 위 명령어 사용 전 **반드시 백업**

2. **서버 부하 주의**
   - `/자동실행시작` - 많은 API 호출 발생
   - `/동맹확인` - 모든 멤버 처리로 시간 소요
   - `/대기열추가 @역할` - 대량 사용자 추가 시 부하
   - **서버 피크 시간대 피해서 실행**

3. **권한 관리**
   - 콜사인 관리자 역할은 신뢰할 수 있는 사용자에게만 부여
   - 관리자 명령어 사용 내역은 로그에 기록됨
   - 잘못된 명령어 사용 시 사용자에게 영향 가능

4. **데이터 정확성**
   - 국가/마을명은 Planet Earth 서버와 정확히 일치해야 함
   - UUID 기반 저장이므로 이름 변경은 문제없음
   - 역할 ID는 숫자로만 구성되어야 함

5. **자동 실행 주의**
   - 스케줄러 설정 확인: `/스케줄확인`
   - 자동 실행 역할 올바르게 설정되었는지 확인
   - 예외 사용자 목록 사전 점검

---

## 문제 해결

### 문제 1: 명령어가 응답하지 않음
**원인:**
- 봇이 오프라인
- 권한 부족
- Discord API 지연

**해결 방법:**
1. `/테스트` 명령어로 봇 연결 확인
2. 자신의 역할에 관리자 권한이 있는지 확인
3. 봇 재시작

---

### 문제 2: 자동 실행이 작동하지 않음
**원인:**
- 역할 ID 잘못 설정
- 스케줄러 비활성화
- API 연동 오류

**해결 방법:**
1. `/스케줄확인`으로 설정 확인
2. `/자동실행 역할id:[올바른 ID]`로 재설정
3. `/자동실행시작`으로 수동 테스트

---

### 문제 3: 역할이 제대로 부여되지 않음
**원인:**
- 동맹/마을 설정 오류
- UUID 불일치
- API 데이터 오래됨

**해결 방법:**
1. `/동맹설정 list`로 설정 확인
2. `/마을역할 list`로 매핑 확인
3. `/동맹확인`으로 강제 동기화
4. `/대기열추가 @사용자`로 개별 재처리

---

### 문제 4: 콜사인 변경이 안 됨
**원인:**
- 쿨타임 미경과 (15일)
- 금지된 콜사인
- 데이터베이스 오류

**해결 방법:**
1. `/콜사인관리 user-search @사용자`로 쿨타임 확인
2. `/콜사인관리 ban-list`로 금지 목록 확인
3. 관리자 권한으로 `/콜사인관리 cooldown-reset` 사용

---

### 문제 5: 로그가 저장되지 않음
**원인:**
- 로그 데이터베이스 오류
- 디스크 공간 부족
- log_manager 모듈 비활성화

**해결 방법:**
1. `/로그관리 statistics`로 상태 확인
2. `data/logs/` 폴더 권한 확인
3. 디스크 공간 확인
4. 봇 재시작

---

### 문제 6: API 연동 오류
**원인:**
- Planet Earth API 서버 다운
- API 주소 변경
- 네트워크 문제

**해결 방법:**
1. `/마을테스트`로 API 연결 확인
2. `.env` 파일의 `MC_API_BASE` 확인
3. 웹 브라우저로 API 주소 직접 접속 테스트
4. Planet Earth 서버 관리자에게 문의

---

## 추가 리소스

- [메인 README.md](README.md) - 봇 전체 개요 및 설치 방법
- [LOG_MANAGER_README.md](LOG_MANAGER_README.md) - 로그 시스템 상세 문서
- [.env.example](.env.example) - 환경 변수 설정 참고

---

## 변경 이력

- **2025-01-16**: 관리자 명령어 가이드라인 초안 작성
  - 18개 관리자 명령어 문서화
  - 권한 체계 및 사용법 정리
  - 모범 사례 및 문제 해결 가이드 추가

---

## 문의

문제가 발생하거나 질문이 있으면:
- GitHub Issues에 등록
- Discord 서버 관리자에게 문의
- 이메일: cerbaggemoon@gmail.com

---

**© 2025 MF_MNT. All rights reserved.**
